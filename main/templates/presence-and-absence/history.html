{% load static %}

<!doctype html>
<html lang="fa" class="min-vh-100" dir="rtl">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>گزارش گیری تاریخچه | برنامه آموزشی دانشگاه</title>

    <!-- Scripts -->
    <link rel="stylesheet" href="{% get_static_prefix %}css/style.css">
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link
        href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
        rel="stylesheet" />
    <script
        src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <style>
        body {
            font-family: 'Shabnam' !important;
        }

        @media print {
            th, td {
                border: 1px solid black !important;
            }
            @page {
                size: A3;
            }
            body {
                visibility: hidden;
            }
            #printable_table {
                visibility: visible;
                position: fixed;
                z-index: 10000;
                top: 0;
                right:0;
                width: 100%;
                object-fit: cover;
            }
        }
    </style>
</head>

<body class="bg-light">
    <div id="app">
        {% include "inc/nav.html" %}

        <main class="py-4 min-vh-100  row row-cols-2 m-0 "
            style="padding-top: 4.5rem !important">
            <div class="col-2 bg-primary shadow d-none d-md-block"
                style="border-radius: 50px 0 0 50px">
                {% include "inc/menu.html" %}
                
            </div>
            <div class="card col-11 col-md-9 mx-auto shadow px-0"
                style="border-radius: 50px; overflow: hidden;">
                {% if classes == False %}
                <div class="alert alert-danger text-center" role="alert">
                     ابتدا موردی از اطلاعات نوار بالا را  انتخاب کنید!
                </div>
                {% else %}
                <div class="card-header px-4 text-bg-primary">
                    گزارش گیری تاریخچه </div>
                <div class="card-body bg-primary-subtle">
                    <div class="row mb-3">
                        <div class="col">
                            <button
                                type="button" class="btn btn-primary w-100"  onclick="window.print();">پیش
                                نمایش <i class="bi bi-eye"></i></button>
                        </div>

                        <div class="col">
                            <button 
                                type="button"
                                class="btn btn-warning text-white w-100"  onclick="window.print();">دانلود
                                PDF <i class="bi bi-download"></i></button>
                        </div>
                    </div>

                    <div class="table-responsive text-center">
                        <table id="printable_table"
                            class="table table-bordered border-secondary rounded shadow-sm h-100">
                            <thead>
                                <tr>
                                    <th
                                        class="text-center align-middle fw-normal">
                                        کلاس</th>
                                    <th
                                        class="text-center align-middle fw-normal text-success">
                                        <i class="bi bi-check-circle"></i> تشکیل
                                        شده
                                    </th>
                                    <th
                                        class="text-center align-middle fw-normal text-danger">
                                        <i class="bi bi-x-circle"></i> تشکیل
                                        نشده
                                    </th>
                                    <th
                                        class="text-center align-middle fw-normal text-warning">
                                        <i class="bi bi-slash-circle"></i> کلاس
                                        خالی
                                    </th>
                                    <th
                                        class="text-center align-middle fw-normal text-primary">
                                        <i class="bi bi-info-circle"></i> 
                                        مجموع تشکیل شده
                                    </th>
                                </tr>
                            </thead>

                            <tbody>

                                {% for class in classes %}
                                <tr>
                                    <th class="text-center align-middle fw-normal text-nowrap"
                                        scope="row">
                                        درس :
                                        {{ class.course.name }}
                                        <br>
                                        استاد :
                                        {{ class.teacher.name }}
                                        <br>
                                        گروه آموزشی :
                                        {{ class.group.title }} 
                                        <br>

                                    </th>

                                    <td class="text-center align-middle">
                                        {% for p in class.panda_set.all %}
                                            {% if p.stat == 1 %}
                                                {{ p.date }}
                                                <br>
                                            {% endif %}
                                        {% endfor %}
                                    </td>

                                    <td class="text-center align-middle">
                                        {% for p in class.panda_set.all %}
                                            {% if p.stat == 0 %}
                                                {{ p.date }}
                                                <br>
                                            {% endif %}
                                        {% endfor %}
                                    </td>

                                    <td class="text-center align-middle">
                                        {% for p in class.panda_set.all %}
                                            {% if p.stat == -1 %}
                                                {{ p.date }}
                                                <br>
                                            {% endif %}
                                        {% endfor %}
                                    </td>
                                    <td class="text-center align-middle count">
                                    </td>
                                </tr>
                                {% endfor %}

                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer text-bg-primary" dir="ltr">
                </div>
                {% endif %}
            </div>

        </main>
    </div>

</body>
<script>
    $(".count").each(function (index) {
        let count = $(this).parent().children("td:nth-child(2)")[0].getElementsByTagName('br').length;
        $(this).text(count);
    });
</script>
</html>
{% load static %}

<!doctype html>
<html lang="fa" class="min-vh-100" dir="rtl">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSRF Token -->
    <meta name="csrf-token" content="4HuVd2ZorvA7Mg1YQ6ZbQ9nRer37bYiTJ1SWrTYD">

    <title>گزارش گیری | برنامه آموزشی دانشگاه</title>

    <!-- Scripts -->
    <link rel="stylesheet" href="{% get_static_prefix %}css/style.css">
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link
        href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
        rel="stylesheet" />
    <script
        src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <style>
        body {
            font-family: 'Shabnam' !important;
        }

        .selection {
            border-width: 0 !important;
        }

        .select2-selection {
            border: 0 !important;
        }
    </style>
</head>

<body class="bg-light">
    <div id="app">
        {% include "inc/nav.html" %}

        <main class="py-4 min-vh-100  row row-cols-2 m-0 "
            style="padding-top: 4.5rem !important">
            <div class="col-2 bg-primary shadow d-none d-md-block"
                style="border-radius: 50px 0 0 50px">
                {% include "inc/menu.html" %}

            </div>
            <div class="card col-11 col-md-9 mx-auto shadow px-0"
                style="border-radius: 50px; overflow: hidden;">
                {% if classes == False %}
                <div class="alert alert-danger text-center" role="alert">
                    ابتدا ترم و دانشکده را از بالای صفحه انتخاب کنید!
                </div>
                {% else %}
                <div class="card-header px-4 text-bg-primary">
                    گزارش گیری </div>
                <div class="card-body bg-primary-subtle">
                    <div class="alert alert-warning text-center" role="alert">
                        در صورتی که قصد اعمال همه ی کلاس ها را دارید تمام لیست
                        ها را خالی بگذارید.
                        <br>
                        برای انتخاب چندتایی در هر لیست دکمه "ctrl" کیبورد را نگه
                        داشته و با موس اقدام به انتخاب نمایید.
                        <br>
                        درصورت وجود نداشتن درس, استاد و ... مدنظر در لیست های
                        زیر به معنای عدم <a class="link-primary"
                            href="{% url 'main:add_class' %}">
                            تعریف کلاس</a> برای آنهاست.
                    </div>

                    <form id="schedule-form"
                        class="row row-cols-1 row-cols-md-2 row-cols-lg-3 mb-4"
                        action="#"
                        method="POST" enctype="multipart/form-data" onsubmit="return false" >
                        
                            <div class="col">
                                <label for="classes" class="form-label">همه کلاس ها
                                    :</label>
                                <select name="classes[]"
                                    class="js-example-basic-multiple text-center"
                                    id="classes" multiple disabled>
                                    <option disabled>کلاس ها را انتخاب کنید</option>
                                    {% for class in classes %}
                                    <option value="{{ class.id }}">
                                        {{ class.course.name }} {{ class.teacher.name }} (
                                            {% if class.day == 0 %}
                                                شنبه
                                            {% elif class.day == 1 %}
                                                یک شنبه
                                            {% elif class.day == 2 %}
                                                دو شنبه
                                            {% elif class.day == 3 %}
                                                سه شنبه
                                            {% elif class.day == 4 %}
                                                چهار شنبه
                                            {% endif %}
                                             {{ class.time.title }}
                                        )                                    
                                    </option>
                                    
                                    {% endfor %}
                                    
                                </select>
                            </div>
    
                            <div class="col">
                                <label for="professors" class="form-label">کلاس های
                                    اساتید :</label>
                                <select name="professors[]"
                                    class="js-example-basic-multiple text-center"
                                    id="professors" multiple>
                                    <option disabled>اساتید را انتخاب کنید</option>
    
                                    {% for teacher in teachers %}
                                        <option value="{{ teacher.id }}">{{ teacher.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
    
                            <div class="col">
                                <label for="groups"
                                    class="form-label">کلاس های گروه های
                                    آموزشی :</label>
                                <select name="educational_groups[]"
                                    class="js-example-basic-multiple text-center"
                                    id="groups" multiple>
                                    <option disabled>گروه ها را انتخاب کنید</option>
                                    {% for group in groups %}
                                    <option value="{{ group.id }}">{{ group.title }}</option>
                                    {% endfor %}
                                </select>
                            </div>
    
                            <div class="col">
                                <label for="entries" class="form-label">کلاس های
                                    ورودی ها :</label>
                                <select name="entries[]"
                                    class="js-example-basic-multiple text-center"
                                    id="entries" multiple>
                                    <option disabled>کلاس ها را انتخاب کنید</option>
    
                                    {% for entry in entries %}
                                    <option value="{{ entry.id }}">{{ entry.title }}</option>
    
                                    {% endfor %}
                                </select>
                            </div>
    
                            <div class="col">
                                <label for="status" class="form-label">وضعیت کلاس
                                    ها:</label>
                                <select name="status"
                                    class="form-select text-center" id="status">
                                    <option value="" selected>وضعیت را انتخاب کنید
                                    </option>
                                    <option value="0">ثابت</option>
                                    <option value="1">چرخشی</option>
                                </select>
    
                                <div class="form-check form-switch mt-4">
                                    <input name="manually_select" value="true"
                                        class="form-check-input" type="checkbox"
                                        role="switch" id="manually-select">
                                    <label class="form-check-label"
                                        style="margin-right: 40px"
                                        id="manually-select-label">انتخاب دستی کلاس
                                        ها</label>
                                </div>
                            </div>
    
                            <div class="col row row-cols-2 text-nowrap user-select-none mt-3"
                                style="font-size: 0.8rem !important">
                                <div class="col">
                                    <div class="form-check">
                                        <input name="show_lesson_name"
                                            id="show_lesson_name"
                                            class="form-check-input" type="checkbox"
                                            value="true" checked>
                                        <label class="form-check-label"
                                            style="margin-right: 25px"
                                            for="show_lesson_name">
                                            نمایش نام درس
                                        </label>
                                    </div>
    
                                    <div class="form-check">
                                        <input name="show_professor_name"
                                            id="show_professor_name"
                                            class="form-check-input" type="checkbox"
                                            value="true" checked>
                                        <label class="form-check-label"
                                            style="margin-right: 25px"
                                            for="show_professor_name">
                                            نمایش نام استاد
                                        </label>
                                    </div>
                                </div>
    
                                <div class="col">
                                    <div class="form-check">
                                        <input name="show_status" id="show_status"
                                            class="form-check-input" type="checkbox"
                                            value="true" checked>
                                        <label class="form-check-label"
                                            style="margin-right: 25px"
                                            for="show_status">
                                            نمایش وضعیت
                                        </label>
                                    </div>
    
                                    <div class="form-check">
                                        <input name="show_entry_year"
                                            id="show_entry_year"
                                            class="form-check-input" type="checkbox"
                                            value="true" checked>
                                        <label class="form-check-label"
                                            style="margin-right: 25px"
                                            for="show_entry_year">
                                            نمایش ورودی
                                        </label>
                                    </div>
    
                                    <div class="form-check">
                                        <input name="show_eg_name" id="show_eg_name"
                                            class="form-check-input" type="checkbox"
                                            value="true" checked>
                                        <label class="form-check-label"
                                            style="margin-right: 25px"
                                            for="show_eg_name">
                                            نمایش گروه آموزشی
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                        <div class="col">
                            <button id="save-button" type="button" onclick="filter_data()"
                                class="btn btn-success w-100 mt-4">اعمال <i
                                    class="bi bi-check-lg"></i></button>
                        </div>

                        <div class="col">
                            <button id="preview-button" type="button"
                                class="btn btn-primary w-100 mt-4">پیش نمایش <i
                                    class="bi bi-eye"></i></button>
                        </div>

                        <div class="col">
                            <button id="download-button" type="button"
                                class="btn btn-warning text-white w-100 mt-4">دانلود
                                PDF <i class="bi bi-download"></i></button>
                        </div>
                    </form>

                    <div class="table-responsive text-center">
                        <table
                            class="table table-bordered table-responsive border-secondary rounded shadow-sm"
                            style="font-size: 12px">
                            <thead>
                                <tr>
                                    <th class="text-center align-middle fw-normal border-bottom-0"
                                        style="width: min-content ">روز<br>هفته
                                    </th>
                                    <th class="p-0 border-bottom-0" colspan="5">
                                        <table class="table w-100 mb-0">
                                            <thead>
                                                <tr
                                                    style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr ">
                                                    <th
                                                        class="text-center align-middle fw-normal">
                                                        ساعت<br>کلاس</th>
                                                    {% for location in locations %}
                                                    <th
                                                        class="text-center align-middle fw-normal">
                                                        کلاس<br>{{ location.title }}</th>
                                                    {% endfor %}
                                                </tr>
                                            </thead>
                                        </table>
                                    </th>
                                </tr>
                            </thead>

                            <tbody>

                                <tr>
                                    <th class="text-center align-middle fw-normal text-nowrap"
                                        style="writing-mode: vertical-rl;"
                                        scope="row">شنبه</th>

                                    <td class="p-0 table-responsive"
                                        colspan="5">
                                        <table class="table align-middle m-0">
                                            <tbody>
                                                {% for time in times %}
                                                <tr style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr ">
                                                    <th
                                                        class="d-flex align-items-center justify-content-center align-middle fw-normal text-nowrap">
                                                        {{ time.title }}</th>

                                                    {% for location in locations %}
                                                    <td
                                                        class="text-center px-0 fw-normal">
                                                    {% for class in classes %}
                                                    {% if class.location == location and class.day == 0 and class.time == time %}
                                                    <div class="px-1">
<span class="class_id-{{ class.id }} teacher_id-{{ class.teacher.id }} status_id-{{ class.stat }} group_id-{{ class.group.id }} entry_id-{{ class.entry.id }} spanid"></span>

                                                        <div class="write-group">
                                                        گروه درس :
                                                        {{ class.group.title }}
                                                        </div>

                                                        <div class="write-course">

                                                        درس :
                                                        {{ class.course.name }}

                                                        </div>

                                                        <div class="write-teacher">
                                                        استاد :
                                                        {{ class.teacher.name }}

                                                        </div>

                                                        <div class="write-stat">

                                                        وضعیت :
                                                        {% if class.stat == 0 %}
                                                        ثابت
                                                        {% else %}
                                                        چرخشی
                                                        {% endif %}
                                                        </div>

                                                        <div class="write-entry">

                                                        ورودی :
                                                        {{ class.entry.title }}
                                                        </div>
                                                    </div>
                                                    {% endif %}
                                                    {% endfor %}
                                                    </td>
                                                    {% endfor %}
                                                    
                                                </tr>
                                                {% endfor %}
                                                
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                                <tr>

                                    <th class="text-center align-middle fw-normal text-nowrap"
                                        style="writing-mode: vertical-rl;"
                                        scope="row">یکشنبه</th>

                                    <td class="p-0 table-responsive"
                                        colspan="5">
                                        <table class="table align-middle m-0">
                                            <tbody>
                                                {% for time in times %}
                                                <tr style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr ">
                                                    <th
                                                        class="d-flex align-items-center justify-content-center align-middle fw-normal text-nowrap">
                                                        {{ time.title }}</th>

                                                    {% for location in locations %}
                                                    <td
                                                        class="text-center px-0 fw-normal">
                                                    {% for class in classes %}
                                                    {% if class.location == location and class.day == 1 and class.time == time %}
                                                    <div class="px-1">
<span class="class_id-{{ class.id }} teacher_id-{{ class.teacher.id }} status_id-{{ class.stat }} group_id-{{ class.group.id }} entry_id-{{ class.entry.id }} spanid"></span>

                                                        <div class="write-group">
                                                        گروه درس :
                                                        {{ class.group.title }}
                                                        </div>

                                                        <div class="write-course">

                                                        درس :
                                                        {{ class.course.name }}

                                                        </div>

                                                        <div class="write-teacher">
                                                        استاد :
                                                        {{ class.teacher.name }}

                                                        </div>

                                                        <div class="write-stat">

                                                        وضعیت :
                                                        {% if class.stat == 0 %}
                                                        ثابت
                                                        {% else %}
                                                        چرخشی
                                                        {% endif %}
                                                        </div>

                                                        <div class="write-entry">

                                                        ورودی :
                                                        {{ class.entry.title }}
                                                        </div>
                                                    </div>
                                                    {% endif %}
                                                    {% endfor %}
                                                    </td>
                                                    {% endfor %}
                                                    
                                                </tr>
                                                {% endfor %}
                                                
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                                <tr>

                                    <th class="text-center align-middle fw-normal text-nowrap"
                                        style="writing-mode: vertical-rl;"
                                        scope="row">دوشنبه</th>

                                    <td class="p-0 table-responsive"
                                        colspan="5">
                                        <table class="table align-middle m-0">
                                            <tbody>
                                                {% for time in times %}
                                                <tr style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr ">
                                                    <th
                                                        class="d-flex align-items-center justify-content-center align-middle fw-normal text-nowrap">
                                                        {{ time.title }}</th>

                                                    {% for location in locations %}
                                                    <td
                                                        class="text-center px-0 fw-normal">
                                                    {% for class in classes %}
                                                    {% if class.location == location and class.day == 2 and class.time == time %}
                                                    <div class="px-1">
<span class="class_id-{{ class.id }} teacher_id-{{ class.teacher.id }} status_id-{{ class.stat }} group_id-{{ class.group.id }} entry_id-{{ class.entry.id }} spanid"></span>

                                                        <div class="write-group">
                                                        گروه درس :
                                                        {{ class.group.title }}
                                                        </div>

                                                        <div class="write-course">

                                                        درس :
                                                        {{ class.course.name }}

                                                        </div>

                                                        <div class="write-teacher">
                                                        استاد :
                                                        {{ class.teacher.name }}

                                                        </div>

                                                        <div class="write-stat">

                                                        وضعیت :
                                                        {% if class.stat == 0 %}
                                                        ثابت
                                                        {% else %}
                                                        چرخشی
                                                        {% endif %}
                                                        </div>

                                                        <div class="write-entry">

                                                        ورودی :
                                                        {{ class.entry.title }}
                                                        </div>
                                                    </div>
                                                    {% endif %}
                                                    {% endfor %}
                                                    </td>
                                                    {% endfor %}
                                                    
                                                </tr>
                                                {% endfor %}
                                                
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                                <tr>

                                    <th class="text-center align-middle fw-normal text-nowrap"
                                        style="writing-mode: vertical-rl;"
                                        scope="row">سه شنبه</th>

                                    <td class="p-0 table-responsive"
                                        colspan="5">
                                        <table class="table align-middle m-0">
                                            <tbody>
                                                {% for time in times %}
                                                <tr style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr ">
                                                    <th
                                                        class="d-flex align-items-center justify-content-center align-middle fw-normal text-nowrap">
                                                        {{ time.title }}</th>

                                                    {% for location in locations %}
                                                    <td
                                                        class="text-center px-0 fw-normal">
                                                    {% for class in classes %}
                                                    {% if class.location == location and class.day == 3 and class.time == time %}
                                                    <div class="px-1">
<span class="class_id-{{ class.id }} teacher_id-{{ class.teacher.id }} status_id-{{ class.stat }} group_id-{{ class.group.id }} entry_id-{{ class.entry.id }} spanid"></span>

                                                        <div class="write-group">
                                                        گروه درس :
                                                        {{ class.group.title }}
                                                        </div>

                                                        <div class="write-course">

                                                        درس :
                                                        {{ class.course.name }}

                                                        </div>

                                                        <div class="write-teacher">
                                                        استاد :
                                                        {{ class.teacher.name }}

                                                        </div>

                                                        <div class="write-stat">

                                                        وضعیت :
                                                        {% if class.stat == 0 %}
                                                        ثابت
                                                        {% else %}
                                                        چرخشی
                                                        {% endif %}
                                                        </div>

                                                        <div class="write-entry">

                                                        ورودی :
                                                        {{ class.entry.title }}
                                                        </div>
                                                    </div>
                                                    {% endif %}
                                                    {% endfor %}
                                                    </td>
                                                    {% endfor %}
                                                    
                                                </tr>
                                                {% endfor %}
                                                
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                                <tr>

                                    <th class="text-center align-middle fw-normal text-nowrap"
                                        style="writing-mode: vertical-rl;"
                                        scope="row">چهارشنبه</th>

                                    <td class="p-0 table-responsive"
                                        colspan="5">
                                        <table class="table align-middle m-0">
                                            <tbody>
                                                {% for time in times %}
                                                <tr style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr ">
                                                    <th
                                                        class="d-flex align-items-center justify-content-center align-middle fw-normal text-nowrap">
                                                        {{ time.title }}</th>

                                                    {% for location in locations %}
                                                    <td
                                                        class="text-center px-0 fw-normal">
                                                    {% for class in classes %}
                                                    {% if class.location == location and class.day == 4 and class.time == time %}
                                                    <div class="px-1">
<span class="class_id-{{ class.id }} teacher_id-{{ class.teacher.id }} status_id-{{ class.stat }} group_id-{{ class.group.id }} entry_id-{{ class.entry.id }} spanid"></span>

                                                        <div class="write-group">
                                                        گروه درس :
                                                        {{ class.group.title }}
                                                        </div>

                                                        <div class="write-course">

                                                        درس :
                                                        {{ class.course.name }}

                                                        </div>

                                                        <div class="write-teacher">
                                                        استاد :
                                                        {{ class.teacher.name }}

                                                        </div>

                                                        <div class="write-stat">

                                                        وضعیت :
                                                        {% if class.stat == 0 %}
                                                        ثابت
                                                        {% else %}
                                                        چرخشی
                                                        {% endif %}
                                                        </div>

                                                        <div class="write-entry">

                                                        ورودی :
                                                        {{ class.entry.title }}
                                                        </div>
                                                    </div>
                                                    {% endif %}
                                                    {% endfor %}
                                                    </td>
                                                    {% endfor %}
                                                    
                                                </tr>
                                                {% endfor %}
                                                
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer text-bg-primary" dir="ltr">
                </div>
                {% endif %}

            </div>

        </main>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            $('.js-example-basic-multiple').select2();
            $('.js-example-basic-single').select2();

            const manually_select = document.getElementById('manually-select');

            const classes = document.getElementById('classes')
            const professors = document.getElementById('professors')
            const educational_groups = document.getElementById('groups')
            const entries = document.getElementById('entries')
            const status = document.getElementById('status')

            

            manually_select.addEventListener("click", () => {
                classes.toggleAttribute("disabled");
                professors.toggleAttribute("disabled");
                educational_groups.toggleAttribute("disabled");
                entries.toggleAttribute("disabled");
                status.toggleAttribute("disabled");
            })
        });

        function filter_data() {
            $("td > div").show();

            if ($("#manually-select").is(':checked')) {
                let classes = $("select#classes").val();
                if (classes.length > 0) {
                    $("td > div").each(function () {
                        let flag = false;
                        for (let i = 0; i < classes.length; i++) {
                            if ($(this).children('.spanid').hasClass(`class_id-${classes[i]}`)) {
                                flag = true;
                                break;
                            }                
                        }
                        if (flag == false) {
                            $(this).hide();
                        }
                    });
                }
            } else {
                let professors = $("select#professors").val();
                if (professors.length > 0) {
                    $("td > div").each(function () {
                        let flag = false;
                        for (let i = 0; i < professors.length; i++) {
                            if ($(this).children('.spanid').hasClass(`teacher_id-${professors[i]}`)) {
                                flag = true;
                                break;
                            }                
                        }
                        if (flag == false) {
                            $(this).hide();
                        }
                    });
                }

                let groups = $("select#groups").val();
                if (groups.length > 0) {
                    $("td > div").each(function () {
                        let flag = false;
                        for (let i = 0; i < groups.length; i++) {
                            if ($(this).children('.spanid').hasClass(`group_id-${groups[i]}`)) {
                                flag = true;
                                break;
                            }                
                        }
                        if (flag == false) {
                            $(this).hide();
                        }
                    });
                }

                let entries = $("select#entries").val();
                if (entries.length > 0) {
                    $("td > div").each(function () {
                        let flag = false;
                        for (let i = 0; i < entries.length; i++) {
                            if ($(this).children('.spanid').hasClass(`entry_id-${entries[i]}`)) {
                                flag = true;
                                break;
                            }                
                        }
                        if (flag == false) {
                            $(this).hide();
                        }
                    });
                }

                let status = $("select#status").val();
                if (status.length > 0) {
                    $("td > div").each(function () {
                        let flag = false;
                        for (let i = 0; i < status.length; i++) {
                            if ($(this).children('.spanid').hasClass(`status_id-${status[i]}`)) {
                                flag = true;
                                break;
                            }                
                        }
                        if (flag == false) {
                            $(this).hide();
                        }
                    });
                }
            }
            
            $("td select").next().show();

            if (! $("#show_lesson_name").is(':checked')) {
                $("td div div").each(function () {
                    if ($(this).hasClass("write-course")) {
                        $(this).hide();
                    }
                });
            }

            if (! $("#show_professor_name").is(':checked')) {
                $("td div div").each(function () {
                    if ($(this).hasClass("write-teacher")) {
                        $(this).hide();
                    }
                });
            }

            if (! $("#show_status").is(':checked')) {
                $("td div div").each(function () {
                    if ($(this).hasClass("write-stat")) {
                        $(this).hide();
                    }
                });
            }

            if (! $("#show_eg_name").is(':checked')) {
                $("td div div").each(function () {
                    if ($(this).hasClass("write-group")) {
                        $(this).hide();
                    }
                });
            }

            if (! $("#show_entry_year").is(':checked')) {
                $("td div div").each(function () {
                    if ($(this).hasClass("write-entry")) {
                        $(this).hide();
                    }
                });
            }

        }
    </script>
</body>

</html>